--- 
title: "Programação em R para biotecnologistas (em elaboração)"
author: 'Prof. Dr. Iuri E. P. Ferreira e Prof. Dr. Jorge L. R. Pantoja Filho. Universidade Federal de São Carlos, Campus Lagoa do Sino'
date: "5 de outubro de 2023"
output:
  html_document:
    df_print: paged
documentclass: book
bibliography:
- book.bib
- packages.bib
#url: "https://iep-ferreira.github.io/curso-biotec-days-R/"
#cover-image: "images/imagem-projeto.png"
description: |
  This is a minimal example of using the bookdown package to write a book.
  set in the _output.yml file.
  The HTML output format for this example is bookdown::gitbook,
link-citations: yes
github-repo: "rstudio/bookdown-demo"
site: bookdown::bookdown_site
---

# Apresentação


## Quem somos? 





<div align = "justify"> 

Este material foi elaborado pela equipe do Centro de Modelagem Estatística em Ciências Ambientais (Ce-MECA), da UFSCar Lagoa do Sino. Visite o [nosso site!](https://sites.google.com/ufscar.br/cemeca) </p>

</div>

```{r echo=FALSE, out.width='550px', fig.align='center'}
knitr::include_graphics("images/logo3.jpg")
```

## Iniciativas 
    

  + <h4> Projeto Ciência de Dados na Lagoa do Sino </h4>


<div align = "justify"> 

O programa estabelece um espaço devotado à discussão e popularização da Ciência de Dados, a fim de criar uma ponte entre educandos da UFSCar e profissionais e empresas da área. </p> 

</div>

```{r echo=FALSE, out.width='600px', fig.align='center'}
knitr::include_graphics("images/imagem-projeto.png")
```

  + <h4> Grupo de Ciência de Dados e Aplicações Tecnológicas </h4>
    

<div align = "justify"> 

As aplicações em Ciência dos Dados são crescentes, e o seu impacto na sociedade hoje é imensurável. Hoje, encontramos algoritmos estatísticos ''em produção'' por toda a parte: nos sites de notícias, nas redes sociais, nos carros autônomos, no marketing digital etc. Atualmente, a inteligência artificial tem impactado todas as áreas criativas, e suas diversas aplicações abrem novas possibilidades e nos causam espanto. Nos dias atuais, um volume crescente de dados é gerado, e este volume está aquém das capacidades humanas de processamento e aquisição de conhecimento. Neste contexto, há uma demanda crescente por cientistas de dados. Recentemente, na UFSCar Lagoa do Sino, um grupo multidisciplinar de pesquisadores tem se reunido frequentemente para discutir pautas relacionadas à Ciência de Dados e suas aplicações nas mais diversas áreas do conhecimento. </p>

</div>
    
Linhas de Pesquisa: 

    + Aprendizado de Máquinas 
  
    + Modelagem Estatística em Ciências Ambientais e Ecologia
  
    + Vieses e Processos de Tomada de Decisões

  + <h4> Programas de Iniciação Científica e Estágios </h4>

```{r echo=FALSE, out.width='500px', fig.align='center'}
knitr::include_graphics("images/estagios.png")
```
  
  + <h4> Estudos e Capacitações </h4>


```{r echo=FALSE, out.width='700px', fig.align='center'}
knitr::include_graphics("images/linhas-interesses.png")
```

## Projetos de Pesquisa

<style>
.scrollable-section {
  height: 500px;
  overflow-y: scroll;
  border: 1px solid #ccc;
  padding: 10px;
}
</style>


<div class="scrollable-section">

<!-- Projeto Biomastats -->
<table width="100%">
  <tr>
    <td width="40%">
      <img src="images/proj-bioma-stats.png" width="400px"/>
    </td>
    <td width="60%">

<summary> <b> Biomastats </b> </summary>

    
Um pacote para a elaboração de relatórios ambientais automatizados sobre o uso e a ocupação do solo no Brasil. 

Fontana, KO; Souza, CA; Molin, PG; Santana, MF; Ferreira, IEP.  

Fomento: CNPq 

  </td>
  </tr>
</table>

<!-- Projeto Abundância Animal -->
<table width="100%">
  <tr>
    <td width="40%">
      <img src="images/proj-mba.png" width="400px"/>
    </td>
    <td width="60%">

<summary> <b> Plataforma MBA </b> </summary>

Plataforma de simulação baseada em multi-agentes (MBA) e o controle populaciona do Java Porco (Sus scrofa) no Sudoeste Paulista

Bassani, FB; Sanches, A; Ferreira, IEP _et al_. 

  </td>
  </tr>
</table>


<!-- Projeto SIG Socioambiental -->
<table width="100%">
  <tr>
    <td width="40%">
      <img src="images/proj-sig.png" width="400px"/>
    </td>
    <td width="60%">

<summary> <b> SIG Socioambiental </b> </summary>

Um sistema para a visualização e análise de dados socioambientais em recortes do terrotório brasileiro

Bilia, G; Pantoja-Filho, JLR; Ferreira, IEP _et al_. 

  </td>
  </tr>
</table>

<!-- Projeto Métricas da Paisagem -->
<table width="100%">
  <tr>
    <td width="40%">
      <img src="images/proj-met.png" width="400px"/>
    </td>
    <td width="60%">

<summary> <b> Métricas da Paisagem </b> </summary>

Implementação computacional de módulos de processamento, análise e visualização de métricas de paisagens no programa Biomastats 

Camargo, V; Carvalho, HL; Tiezzi, RO; Ferreira, IEP _et al_. 

Fomento: CNPq

  </td>
  </tr>
</table>

<!-- Projeto Modelos Bent-cable e lhas Pequenas  -->
<table width="100%">
  <tr>
    <td width="40%">
      <img src="images/bent-proj.png" width="400px"/>
    </td>
    <td width="60%">

<summary> <b> Modelos Bent-cable e lhas Pequenas </b> </summary>

    
Aplicação de modelos segmentados com transição de fase suave para explicar o Efeito de Ilhas Pequenas a partir da existência de limiares aleatórios

Santana, MF; Zocchi, SS; Leandro, RA; Martensen, AC; Ferreira, IEP 

  </td>
  </tr>
</table>

<!-- Projeto Biomastats GUI  -->

<table width="100%">
  <tr>
    <td width="40%">
      <img src="images/biomastatsGUI.png" width="400px"/>
    </td>
    <td width="60%">

<summary> <b> Biomastats GUI </b> </summary>

    
Desenvolvimento e implantação da Interface Gráfica do Usuário para o programa Biomastats via aplicativos shiny

Santana, MF; Ferreira, IEP

Fomento: CNPq 

  </td>
  </tr>
</table>

</div>


# Origem do R

<div align = "justify"> 

R é uma linguagem de programação criada por Ross Ihaka e 
Robert Gentleman, na universidade de Auckland, Nova Zelândia, 
em meados dos anos 1990. A linguagem R foi uma adaptação da 
linguagem S, criada por John Chambers em 1976, nos laboratórios 
Bell. </p>

R também denomina um programa computacional destinado a análises estatísticas e visualização de dados. O programa R é livre ( _General Public License_ ) e possui código-fonte aberto, sendo aprimorado continuamente por uma rede global de colaboradores, a partir da _R Foundation for Statistical Computing_ , sediada em Viena, na Áustria. </p>

A linguagem R já esteve em 8º dentre as mais populares, no entanto, hoje ela ocupa a 18º posição de acordo com _The TIOBE Programming Community index_ (TIOBE, 2023) . </p>

</div>   

# Primeiros passos  

<style>
    details > summary {
        font-weight: bold;
        margin-top: 10px;
        cursor: pointer;
    }
    
    details > p {
        margin-left: 20px;
    }
    
    details > details > summary {
        margin-left: 20px;
    }
</style>

<div style="text-align: justify"> 

<details>
<summary> Instalação </summary>
Para instalar o R, acesse a página oficial da organização _The R Project for Statistical Computing em  < https://cran.r-project.org/ > . O usuário deverá escolher o arquivo de acordo com o seu sistema operacional. </p>
</details>

<details>
<summary> Execução de códigos </summary>
O R é uma linguagem interpretada. Isso significa que partes do código podem ser executadas diretamente do interpretador (interface R), sem a necessidade de compilar todo código e montar um arquivo executável (.exe). Dessa forma, o usuário seleciona o pedaço do código que deseja executar e, de imediato, tem o resultado impresso no terminal de saída ou na janela gráfica. Se houver erro de sintaxe/interpretação, o programa exibirá um alerta no terminal de saída. </p>  

<details>
<summary> Exercício </summary>
Abra a interface básica do R (R-GUI) e execute o código a seguir: </p>  

```{r}
x <- rnorm(100, 10, 15)
summary(x)
```
</details>
</details>

<details>
<summary> Criando scripts </summary>
Após abrir a interface R, o usuário deverá criar um script (.txt ou .R) no qual os comandos serão salvos. Para executar um bloco de comandos, o usuário deverá selecioná-lo com o cursor do mouse (deixando-o em realce) e, então, pressionar "F5" ou "CTRL+ENTER", a depender da interface em uso. Outra opção é executar o comando, linha a linha, até completar o bloco de comandos desejado. </p> 


<details>
<summary> Exercício </summary>
Abra a interface gráfica do R de preferência e crie um novo arquivo de script R. Escreva algumas linhas de códigos, com comentários. Salve o script em um novo diretório.  </p>  
```{r}
# crie uma lista de números aleatórios normalmente distribuídos
x <- rnorm(100, 10, 15)
# faça um resumo estatístico dos valores obtidos 
summary(x)
# desenhe um diagrama de caixas para os valores amostrados
boxplot(x, main = "Diagrama de Caixas", ylab = "Valores amostrados")
```
</details>
</details>

<details>
<summary> Atribuição de valores </summary>
No R, os resultados podem ser obtidos a partir do uso de funções/expressões ou serem atribuídos a variáveis e gravados na memória do computador. Há diversas formas de atribuir valores a uma variável: `nome <- valor`; `valor -> nome`; `nome = valor`. 
Tanto `->` como `=` funcionam como comandos de atribuição. Uma vantagem do R é o fato de não ser requerida a declaração/inicialização de variáveis, tipos e tamanhos ao início do programa, como é comum em outras linguagens. </p>
R é uma linguagem _case sensitive_, isso significa que letras maiúsculas e minúsculas são diferenciadas no programa. Portanto, uma variável de nome `x` será diferente de outra com nome `X`. </p> 

<details>
<summary> Exemplo </summary>
Execute as linhas de código a seguir e observe a diferença:
```{r}
# Valores atribuídos a variáveis locais
x<-5
10->X
# Diferença entre as variáveis "x" e "X"
5*x; 5*X
```
</details>
</details>

</div>

# Tipos de dados

<style>
    details > summary {
        font-weight: bold;
        margin-top: 10px;
        cursor: pointer;
    }
    
    details > p {
        margin-left: 20px;
    }
    
    details > details > summary {
        margin-left: 20px;
    }
</style>

<div style="text-align: justify"> 

Há diversos tipos de dados que podem ser armazenados na memória do computador e manipulados a partir do programa R. Os dados podem ser numéricos (reais ou inteiros), lógicos (verdadeiro ou falso), caracteres (sequências alfanuméricas), números complexos ou funções. </p>

<details>
<summary> Exemplos </summary>

<details>
<summary> Dado real / ponto flutuante </summary>
```{r}
1/3
```
</details>


<details>
<summary> Dado inteiro </summary>
```{r}
round(1/3)
```
</details>

<details>
<summary> Dado lógico </summary>
```{r}
1<3
```
</details>

<details>
<summary> Dado alfanumérico </summary>
```{r}
nome <- "Carlos Henrique"
```
</details>

<details>
<summary> Dado complexo </summary>
```{r}
# Complexo
(5+6i) - (3-2i)
```
</details>

<details>
<summary> Função </summary>
```{r}
parabola <- function(x, a, b, c){ a*x^2 + b*x + c }
parabola(x = 2, a = 1, b = 1, c = 3)
```

</details>

</details>

O comando `mode` retorna o tipo do dado guardado no objeto que entra como argumento da função (entre parênteses). </p>

<details>
<summary> Exemplo </summary>
```{r}
mode(parabola)
```
</details>

</div>

# Operações Básicas

<style>
    details > summary {
        font-weight: bold;
        margin-top: 10px;
        cursor: pointer;
    }
    
    details > p {
        margin-left: 20px;
    }
    
    details > details > summary {
        margin-left: 20px;
    }
</style>

<div style="text-align: justify"> 

## Operadores matemáticos

```{r echo=FALSE, out.width='300px', fig.align='left', , fig.cap= "Fonte: https://www.statmethods.net/management/operators.html"}
knitr::include_graphics("images/arith-operations.png")
```


## Operadores lógicos

```{r echo=FALSE, out.width='300px', fig.align='left', fig.cap= "Fonte: https://www.statmethods.net/management/operators.html"}
knitr::include_graphics("images/logical-operations.png")
```

</div>

# Desafio 

<style>
    details > summary {
        font-weight: bold;
        margin-top: 10px;
        cursor: pointer;
    }
    
    details > p {
        margin-left: 20px;
    }
    
    details > details > summary {
        margin-left: 20px;
    }
</style>

<div style="text-align: justify"> 

Você consegue seguir a sequência de 11 passos sem errar? </p>

  <details>
  <summary>Passo 1</summary>
  <p>Pense em um número entre 10 e 19</p>
</details>

<details>
  <summary>Passo 2</summary>
  <p>Some os algarismos deste número</p>
</details>

<details>
  <summary>Passo 3</summary>
  <p>Do número pensado, subtraia a soma dos algarismos</p>
</details>

<details>
  <summary>Passo 4</summary>
  <p>Multiplique o resultado por dois</p>
</details>

<details>
  <summary>Passo 5</summary>
  <p>Divida o resultado por três</p>
</details>

<details>
  <summary>Passo 6</summary>
  <p>Subtraia duas unidades do resultado</p>
</details>

<details>
  <summary>Passo 7</summary>
  <p>Correlacione com o alfabeto (1 - A, 2 - B, ...)</p>
</details>

<details>
  <summary>Passo 8</summary>
  <p>Escolha um país que comece por essa letra</p>
</details>

<details>
  <summary>Passo 9</summary>
  <p>Selecione a quinta letra desse país</p>
</details>

<details>
  <summary>Passo 10</summary>
  <p>Pense em uma cor que comece por essa letra</p>
</details>

<details>
  <summary>Passo 11</summary>
  <p>Pense em um animal que comece com essa letra e tenha essa cor</p>
</details>

</div>

# Resposta do desafio

<style>
  #protectedContent {
    display: none;
  }
</style>

<label for="password">Digite a senha para visualizar o conteúdo:</label>
<input type="password" id="password" name="password">
<button onclick="showContent()">Mostrar Conteúdo</button>

<details id="protectedContent">
  

 <figure>
 <img src="images/image-art.png" width="400px"/>
 <figcaption> Fonte: https://www.imagine.art/ </figcaption>
 
 </figure>


Ok! Mas como isso acontece? Para responder, vamos construir um pequeno programa com operações matemáticas e lógicas. </p>

<details>
<summary> Programa </summary>

```{r}
# Atibui o número escolhido à variável num
num <- 16
# Calcula a soma dos algarismos 
algarismos <- as.numeric(strsplit(as.character(num), NULL)[[1]])
soma <- sum(algarismos)
# Passo 3
resultado <- num - soma
# Passo 4
resultado <- resultado*2
# Passo 5 e 6
resultado <- resultado/3 - 2
# Conferência
resultado == 4
```
Observe que o `resultado` é invariante! </p>
</details>

</details>

<script>
  function showContent() {
    var passwordInput = document.getElementById('password').value;
    var correctPassword = 'macacomarrom'; // Defina a senha correta aqui
    
    if (passwordInput === correctPassword) {
      document.getElementById('protectedContent').style.display = 'block';
    } else {
      alert('Senha incorreta!');
    }
  }
</script>

# Inteligência Artificial e Programação  

<div style="text-align: justify"> 

## Avanços recentes em IA

### Aprendizado de Máquina e Aprendizado Profundo

O desenvolvimento de técnicas avançadas de aprendizado de máquina e aprendizado profundo permitiu a criação de modelos de IA mais sofisticados e precisos, capazes de realizar tarefas complexas, como reconhecimento de imagem e processamento de linguagem natural. </p>

### Frameworks e Bibliotecas

Frameworks como `TensorFlow` e `PyTorch` têm facilitado o desenvolvimento e a implementação de modelos de IA, proporcionando ferramentas eficientes e flexíveis para os pesquisadores e desenvolvedores. </p>

## Contribuição em Programação

A IA tem auxiliado programadores através de: </p>

### Automação

Ferramentas de IA podem automatizar tarefas repetitivas, reduzindo o tempo de desenvolvimento e diminuindo a probabilidade de erros. </p>

### Otimização de Código

Sistemas de IA podem sugerir otimizações de código e identificar potenciais bugs e vulnerabilidades, melhorando a qualidade do software. </p>

## Contribuição em Análise de Dados

### Análise Preditiva

Modelos de aprendizado de máquina podem analisar grandes conjuntos de dados para fazer previsões precisas, auxiliando na tomada de decisões em várias indústrias. </p>.

### Visualização de Dados

Ferramentas de IA podem ajudar a criar visualizações de dados mais intuitivas e informativas, permitindo uma melhor compreensão dos dados. </p>

</div>

# Visualização de dados

<div style="text-align: justify"> 

  + Usar a IA para carregar e visualizar dados experimentais de um arquivo `.xls` usando linguagem R
  
  + Prompt: 
  
    + Tarefa: construir um script para visualizar dados experimentais em R; 
    
    + Dados: os dados estão armazenados no caminho `./dados-exemplos/experimento.xlsx`; 
    
    + Contexto: os dados são referentes a um experimento inteiramente aleatorizado com 4 tratamentos e três replicações, cuja finalidade foi observar o efeito da dosagem de essência de limão no pH final de um produto lácteo;  
    
    + Detalhamento: deseja-se um gráfico da resposta `pH` em função da variável `Dose` de essência de limão;
    
    + Ferramentas: use o pacote ggplot2;
    
    + Requisitos: Gráficos em cores para os diferentes `Tratamentos`, com legenda e pontos representados por asteriscos de tamanho médio. O código não deve ultrapassar 15 linhas. 
    
  + Resposta do GPT-4: 
    
```{r message=FALSE, warning=FALSE}
library(ggplot2)
library(readxl)

# Lendo os dados
dados <- read_excel("./dados-exemplos/experimento.xlsx")

# Criando o gráfico
ggplot(dados, aes(x=Dose, y=pH, color=Tratamentos)) +
  geom_point(shape=8, size=3) + 
  labs(color='Tratamento') + 
  theme_minimal()
```
    
  + Atividade: insira o prompt em outra ferramenta de IA (LLM) e observe o resultado
  
</div>
  
# Análise de Regressão

<div style="text-align: justify"> 

Observe que os tratamentos do experimento podem ser analisados de forma qualitativa ou quantitativa. Na análise quantitativa, por exemplo, desejamos ajustar uma curva de tendência e fazer previsões para novos valores da resposta. </p>

## Ajuste da reta 

### Ajuste do modelo linear no R 

A função `lm` é usada para ajustar modelos *estatisticamente* lineares (`lm` = linear model). Na sintaxe do R, a fórmula `pH ~ Dose` representa o ajuste de uma reta de tendência, expressa por 

\[
pH = \beta_0 + \beta_1 \times Dose  
\]

```{r}
mod_reta <- lm( pH ~ Dose, data = dados )
coef( mod_reta )
```

Para ajustar a reta de tendência, torna-se necessário calcular os valores mais plausíveis para os parâmetros $\beta_0$ e $\beta_1$, com base nos dados. As estimativas de $\beta_0$ e $\beta_1$ são obtidas a partir do comando `coef`. 

### Diagnóstico do ajuste da reta 

Ao realizar o diagnóstico de um ajuste linear clássico a partir dos gráficos dos resíduos, esperamos validar os pressupostos do modelo. Os resíduos devem aparentar ser aleatórios, sem padrões discerníveis, indicando homocedasticidade, e devem ser aproximadamente normalmente distribuídos em torno de zero, validando a suposição de normalidade e a independência dos erros, essencial para inferências subsequentes. </p>

  + Análise dos resíduos do ajuste

```{r message=FALSE, warning=FALSE}
plot( mod_reta, 1) # valores ajustados x resíduos
library(car)
qqPlot( residuals( mod_reta ) ) # gráfico quantil-quantil
```
   
Neste caso, obsevamos que o gráfico quantil-quantil não apresenta desvios à normalidade. Porém, no gráfico dos resíduos em função dos valores ajustados, observa-se uma estrutura de variação dos dados não explicada pelo modelo. Os dados deveriam oscilar aleatoriamente em torno do zero, mas não é isso o que acontece. </p>

### Teste de falta de ajuste

Nesta etapa, realizaremos o teste de falta de ajuste para averiguar se o modelo é suficiente para capturar o comportamento dos dados ou se um modelo mais "flexível" deveria ser utilizado. </p>

```{r message=FALSE, warning=FALSE}
mod_quali <- lm( pH ~ Tratamentos, data = dados) # ajuste do modelo qualitativo
# Falta de ajuste 
anova( mod_reta, mod_quali )
```

Pelo teste F, verifica-se que há falta de ajuste considerando-se o nível de 5% de significância. Conclui-se que o modelo não captura bem o comportamento dos dados </p>

### Ajuste do modelo de segundo grau

Com a inserção do termo `I(Dose, 2)` na fórmula, a expressão da curva de tendência passa a ser

\[
pH = \beta_0 + \beta_1 \times Dose + \beta_2 \times Dose^2  
\]

ou seja, uma parábola. Observe que a curvatura exibida por uma parábola pode capturar o comportamento que não foi possível descrever com a reta.  

```{r}
mod_quad <- lm( pH ~ Dose + I(Dose^2), data = dados )
coef( mod_quad )
```

### Diagnóstico do ajuste da parábola 

  + Análise dos resíduos do ajuste

```{r message=FALSE, warning=FALSE}
plot( mod_quad, 1) # valores ajustados x resíduos
library(car)
qqPlot( residuals( mod_quad ) ) # gráfico quantil-quantil
shapiro.test( residuals( mod_quad ) )
```
   
.... </p>

### Teste de falta de ajuste para a parábola

```{r}
# Falta de ajuste 
anova( mod_quad, mod_quali )
```

... </p>

### Comparação de modelos

O Critério de Informação de Akaike (AIC) é fundamentado na teoria da informação, proporcionando uma medida relativa da informação perdida quando um determinado modelo é usado para representar o processo gerador dos dados. Ele avalia a adequação do modelo, considerando tanto a complexidade do modelo quanto o ajuste aos dados. O AIC é calculado como $AIC = 2k - 2\ln(L)$, onde $k$ é o número de parâmetros no modelo, e $L$ é a verossimilhança do modelo. Menores valores de AIC indicam um melhor equilíbrio entre ajuste do modelo e complexidade, permitindo comparar modelos diferentes, mesmo não aninhados, proporcionando uma abordagem robusta para a seleção de modelos na análise estatística. </p>

O coeficiente de determinação (R²), por outro lado, apenas mede a proporção da variância explicada pelo modelo, não penalizando a complexidade, podendo levar à preferência por modelos superajustados (overfitting) que performam mal com dados novos. Portanto, o AIC é frequentemente mais adequado para a seleção de modelos quando se compara um conjunto de modelos.</p>

```{r}
AIC(mod_quali , mod_reta, mod_quad )
```

Neste caso, observa-se que o modelo mais parcimonioso é o quadrático dentre os modelos estudados, pois possui menor perda da informação dos dados originais, além de baixa complexidade, resultando em um AIC inferior. </p> 

</div>

# Ajuste linear a partir da IA


<style>
  .chat-container {
    width: 100%;
    margin: 20px 0;
    font-family: 'Arial', sans-serif;
  }

  .code-block {
    background-color: #f0f0f0;
    border-radius: 5px;
    padding: 10px;
    font-family: 'Courier New', Courier, monospace;
    overflow-x: auto;
    white-space: nowrap;
  }

  .message {
    border: 1px solid #ccc;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 5px;
    background-color: #e6e6e6;
  }

  .bot-message {
    text-align: rigth;
    color: #333;
  }

  .user-message {
    text-align: right;
    color: #4caf50;
  }
</style>



<div style="text-align: justify"> 

Nesta seção nós iremos explorar se ferramentas de inteligência artificial seriam capazes de orientar a análise de regressão e fornecer scripts úteis. </p>

No entanto, **cuidado!** Recomendamos que todas as saídas fornecidas por IA sejam avaliadas por profissionais competentes na área, que se responsabilizem pelos resultados. </p>

Além disso, dados sensíveis, pessoais ou institucionais, não devem ser fornecidos aos operadores de IA via prompts. </p>

## Atividade Prática 1

Construa um prompt para inteligência artificial com o objetivo de obter orientações estatísticas e um script pronto para a análise de regressão e seleção de modelos. 

<div class="chat-container">
  
<details>
<summary> Prompt </summary>
  
  <div class="message bot-message">
    
  + Tarefa: selecionar o modelo que melhor representa a relação entre as variáveis Dose e pH no experimento a seguir; </p>
      
  + Contexto: os dados são referentes a um experimento inteiramente aleatorizado com 4 tratamentos e três replicações, cuja finalidade foi observar o efeito da dosagem de essência de limão no pH final de um produto lácteo;  </p>
    
  + Detalhamento: faça uma comparação estatística entre modelos lineares, determinando qual é o mais parcimonioso; faça diagnóstico do ajuste e análise dos resíduos; verifique, para os modelos ajustados, se há falta de ajuste. </p>
    
  + Ferramentas: Linguagem R e funções do stats; </p>
    
  + Requisitos: apresente as hipóteses testadas, os testes de significância, os valores p e a interpretação estatística. </p>

  + Dados: copiar os dados da tabela e colar aqui! </p>
    
  </div>
  
</details><br>

<details>
<summary> Resposta do _chatGPT-4_ </summary>

<div class="chat-container">

  + 1. Importar os Dados

Primeiramente, você precisa importar os dados para o R. Você pode criar um `data.frame` diretamente. </p>

<div class="code-block">
```{r}
df <- data.frame(
  Unidade = 1:12,
  Tratamentos = rep(LETTERS[1:4], each = 3),
  Dose = rep(c(0, 10, 20, 30), each = 3),
  pH = c(7.3, 6.8, 7.5, 6.5, 6.4, 5.8, 5.2, 4.9, 5.1, 3.2, 2.5, 2.9)
)
```
</div>

```{r include=FALSE}
df <- data.frame(
  Unidade = 1:12,
  Tratamentos = rep(LETTERS[1:4], each = 3),
  Dose = rep(c(0, 10, 20, 30), each = 3),
  pH = c(7.3, 6.8, 7.5, 6.5, 6.4, 5.8, 5.2, 4.9, 5.1, 3.2, 2.5, 2.9)
)
```

  + 2. Ajustar Modelos Lineares

Vamos ajustar alguns modelos lineares e compará-los. Um modelo simples é a regressão linear simples, e outro é um modelo linear com termos polinomiais para considerar efeitos não-lineares da Dose no pH. </p>

<div class="code-block">
```{r}
# Modelo Linear Simples
modelo_linear <- lm(pH ~ Dose, data = df)

# Modelo Linear Quadrático
modelo_quadratico <- lm(pH ~ poly(Dose, 2), data = df)
```
</div>


```{r include=FALSE}
# Modelo Linear Simples
modelo_linear <- lm(pH ~ Dose, data = df)

# Modelo Linear Quadrático
modelo_quadratico <- lm(pH ~ poly(Dose, 2), data = df)
```

  + 3. Comparar Modelos
  
Vamos comparar os modelos usando o teste de anova. </p>


<div class="code-block">
```{r}
anova(modelo_linear, modelo_quadratico)
```
</div>

```{r include=FALSE}
anova(modelo_linear, modelo_quadratico)
```

  + 4. Diagnóstico do Modelo
  
Vamos analisar os resíduos dos modelos ajustados.

<div class="code-block">
```{r}
# Para o Modelo Linear
plot(modelo_linear, 1)

# Para o Modelo Quadrático
plot(modelo_quadratico, 1)
```
</div>

```{r include=FALSE}
# Para o Modelo Linear
plot(modelo_linear, 1)

# Para o Modelo Quadrático
plot(modelo_quadratico, 1)
```

  + 5. Testar a Falta de Ajuste

Para testar a falta de ajuste de cada modelo, podemos comparar a variância dos resíduos de cada modelo.</p>

<div class="code-block">
```{r}
# Teste de Falta de Ajuste para Modelo Linear
anova(modelo_linear)

# Teste de Falta de Ajuste para Modelo Quadrático
anova(modelo_quadratico)
```
</div>
  
```{r include=FALSE}
# Teste de Falta de Ajuste para Modelo Linear
anova(modelo_linear)

# Teste de Falta de Ajuste para Modelo Quadrático
anova(modelo_quadratico)
```
  
  + 6. Interpretação Estatística

Baseado nos p-valores e no diagnóstico dos resíduos, você pode determinar qual modelo é mais apropriado. O modelo com o menor p-valor e os resíduos bem distribuídos (sem padrões aparentes nos gráficos de diagnóstico) será considerado o melhor modelo. Se o p-valor for menor que o nível de significância (geralmente 0,05), você rejeitará a hipótese nula de que não há efeito da Dose no pH. </p>

  + 7. Resumo dos Modelos

Para obter os detalhes dos modelos ajustados, você pode usar a função summary. </p>

<div class="code-block">
```{r}
# Sumário do Modelo Linear
summary(modelo_linear)

# Sumário do Modelo Quadrático
summary(modelo_quadratico)
```
</div>

```{r include=FALSE}
# Sumário do Modelo Linear
summary(modelo_linear)

# Sumário do Modelo Quadrático
summary(modelo_quadratico)
```

Ao executar esses passos, você terá uma boa ideia de qual modelo melhor representa a relação entre Dose e pH para este conjunto de dados, considerando tanto a significância estatística quanto a adequação do modelo aos dados. </p>  

</details>
  
</div>  
</div>

## Atividade Prática 2

Construa um prompt para inteligência artificial com o objetivo de criar uma visualização do ajuste com alta qualidade. 

<div class="chat-container">
  
<details>
<summary> Prompt </summary>
  
  <div class="message bot-message">
    
  + Tarefa: visualização do ajuste do modelo quadrático para a variável pH em função da dose; </p>
      
  + Contexto: os dados são referentes a um experimento inteiramente aleatorizado com quatro doses e três replicações, cuja finalidade foi observar o efeito da dosagem de essência de limão no pH final de um produto lácteo;  </p>
    
  + Detalhamento: faça um gráfico do ajuste do modelo quadrático aos dados experimentais seguindo o estado da arte. O gráfico deve apresentar pontos experimentais, reta do ajuste e intervalo com 95% de confiança para os valores preditos da resposta. O gráfico deve ter rótulos adequados para o eixo x e y, além de cores que dêem destaque na visualização. </p>
    
  + Ferramentas: Linguagem R e pacote plotly; </p>
    
  + Dados: copiar os dados da tabela e colar aqui! </p>
    
  </div>
  
</details><br>

<details>
<summary> Resposta do _chatGPT-4_ </summary>

<div class="chat-container">

<div class="code-block">
```{r message=FALSE, warning=FALSE}
if(!requireNamespace("dplyr", quietly = TRUE)) install.packages("dplyr")
if(!requireNamespace("plotly", quietly = TRUE)) install.packages("plotly")

library(plotly)
library(dplyr)

# Calculando predições e intervalos de confiança
predicoes <- predict(mod_quad, newdata = dados, interval = "prediction", level = 0.95)

# Adicionando as predições e intervalos de confiança ao data frame
dados <- dados %>%
  mutate(
    fitted = predicoes[,"fit"],
    lwr = predicoes[,"lwr"],
    upr = predicoes[,"upr"]
  )

# Gráfico com plotly
plot_vis <- plot_ly(dados) %>%
  add_trace(
    x = ~Dose, 
    y = ~pH, 
    type = 'scatter', 
    mode = 'markers', 
    name = 'Dados Observados',
    marker = list(color = 'red', size = 10)
  ) %>%
  add_trace(
    x = ~Dose, 
    y = ~fitted, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Ajuste Quadrático',
    line = list(color = 'blue')
  ) %>%
  add_trace(
    x = ~Dose, 
    y = ~lwr, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Limite Inferior 95%',
    line = list(color = 'rgba(173,216,230,0.4)')
  ) %>%
  add_trace(
    x = ~Dose, 
    y = ~upr, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Limite Superior 95%',
    fill = 'tonexty',
    line = list(color = 'rgba(173,216,230,0.4)')
  ) %>%
  layout(
    title = "Ajuste Quadrático do pH em função da Dose",
    xaxis = list(title = "Dose (mg)"),
    yaxis = list(title = "pH")
  )

# Visualizar o gráfico
plot_vis
```
</div>

```{r message=FALSE, warning=FALSE, include=FALSE}
if(!requireNamespace("dplyr", quietly = TRUE)) install.packages("dplyr")
if(!requireNamespace("plotly", quietly = TRUE)) install.packages("plotly")

library(plotly)
library(dplyr)

# Calculando predições e intervalos de confiança
predicoes <- predict(mod_quad, newdata = dados, interval = "prediction", level = 0.95)

# Adicionando as predições e intervalos de confiança ao data frame
dados <- dados %>%
  mutate(
    fitted = predicoes[,"fit"],
    lwr = predicoes[,"lwr"],
    upr = predicoes[,"upr"]
  )

# Gráfico com plotly
plot_vis <- plot_ly(dados) %>%
  add_trace(
    x = ~Dose, 
    y = ~pH, 
    type = 'scatter', 
    mode = 'markers', 
    name = 'Dados Observados',
    marker = list(color = 'red', size = 10)
  ) %>%
  add_trace(
    x = ~Dose, 
    y = ~fitted, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Ajuste Quadrático',
    line = list(color = 'blue')
  ) %>%
  add_trace(
    x = ~Dose, 
    y = ~lwr, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Limite Inferior 95%',
    line = list(color = 'rgba(173,216,230,0.4)')
  ) %>%
  add_trace(
    x = ~Dose, 
    y = ~upr, 
    type = 'scatter', 
    mode = 'lines',
    name = 'Limite Superior 95%',
    fill = 'tonexty',
    line = list(color = 'rgba(173,216,230,0.4)')
  ) %>%
  layout(
    title = "Ajuste Quadrático do pH em função da Dose",
    xaxis = list(title = "Dose (mg)"),
    yaxis = list(title = "pH")
  )

# Visualizar o gráfico
plot_vis
```

</details>
  
</div>  
</div>

</div>

# Comparações entre tratamentos 

<div style="text-align: justify"> 

Em experimentos com delineamentos usuais, tais como o inteiramente aleatorizado, as comparações múltiplas podem ser feitas a partir do pacote brasileiro `ExpDes`. </p>

O `ExpDes` apresenta uma função para cada tipo de delineamento experimental. Com ele, também é possível realizar a análise de experimentos com tratamentos em esquema fatorial de forma fácil e intuitiva. Porém, o pacote não comporta recursos para delineamentos mais específicos e para a análise de efeitos aleatórios. </p>

Nesta seção, usamos a função `crd` destinada à análise de Delineamentos Inteiramente Casualizados (_Complete Randomized Desing_). Nesse comando, a entrata `treat` designa o vetor de tratamentos, a entrada `resp` designa o vetor de respostas, `quali` indica se os tratamentos são qualitativos ou não, e os níveis de significância para os testes T e F são atrivuídos por `sigT` e `sigF`, respectivamente. </p>

## Análise quantitativa

```{r message=FALSE, warning=FALSE}
# Carregar o pacote expdes
if(!requireNamespace("ExpDes", quietly = TRUE)) install.packages("ExpDes")
library(ExpDes)

# Realizando a análise com a função dic
resultado_dic <- crd(treat = dados$Dose, resp = dados$pH, quali = FALSE, sigT = 0.05, sigF = 0.05)
```

## Análise qualitativa

`mpcomp` designa o método de comparação múltipla a ser usado

```{r message=FALSE, warning=FALSE}
# Realizando a análise com a função dic
resultado_dic <- crd(treat = dados$Dose, resp = dados$pH, quali = TRUE, mcomp = "tukey", sigT = 0.05, sigF = 0.05)
```

## Gráfico de médias

### Cálculo das margens de erro

Para o cálculo da margem de erro das médias, devemos considerar: 

  + O erro quadrático médio do resíduo (EQMR)
  
\[
EQMR = \frac{\sum_{i =1}^n (y_i - \hat{y}_i)^2}{df_{res}}
\]

  + O erro padrão da média (SE)
  
\[
SE = \sqrt{\frac{EQMR}{r}}
\]  

  + A margem de erro

\[
erro = t_{(1 - \alpha/2; \, df)} \, \sqrt{\frac{EQMR}{r}} = t_{\alpha/2; \, df} \, SE 
\]

em que: 

  - $y_i$ e $\hat{y}_i$ são os valores observados e preditos da resposta; 
  - $df_{res}$ é o número de graus de liberdade para os resíduos da análise; 
  - $r$ é o número de réplicas por tratamentos; 
  - $t_{(1-\alpha/2; \, df)}$ é o quantil da distribuição $t$ considerando-se o nível de significância $\alpha$ e $df$ graus de liberdade.

```{r message=FALSE, warning=FALSE}
(EQMR <- sum( residuals(mod_quali)^2 )/8 )
(SE <- sqrt( EQMR / 3 ))
(ERRO <- qt(0.975, 8)*SE) 
```

Dessa forma, a margem de erro a se considerar para a estimativa das médias de tratamentos é de $0,431$ unidades, isso com 95% de confiança. 

### Prompt para a confecção do gráfico

### Resultado 

</div>

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```
